<!--
// Tristan Skinner
// 19/01/2016
// https://github.com/klunkydata/premRelative201516
	
// Attributes
//********************************************************************************//
// Interactive Data Visualization for the Web, Scott Murray, O'Reilly, 2013,
// ISBN: 978-1-449-33973-9
// http://www.bbc.co.uk/sport/football/results
// http://www.soccerstats.com/results.asp?league=england
//********************************************************************************//
-->
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>PremJourney</title>
		<script type="text/javascript" src="d3.js"></script>
		<style type="text/css">
			/* Enter style rules here.*/
		</style>
	</head>

	<body>	
	<p>Click on this text to start the season! (once).</p>
	
		<script type="text/javascript">
		//--------------------------------------------------------------------------------//
		//-------------------------------- d3 block start --------------------------------//
		//--------------------------------------------------------------------------------//
		
		// Global vals.
		//--------------------------------------------------------------------------------//
		var events;  // objct[] for ea evnt
		var pstnsCSV = "prem1516pstns20160123.csv";	// 23rd Jan
		var iStrt = 1;	// no of clmns from the left to ignore
		var noClubs;
		
		var w = 500;  // svg width
		var h = 100;  // svg hght
		var pddng = 20;  // svg pddng
		var iconPddng = 0.05;  // % of ea icon band as space between ea other
		var intrpltn = 1000;  // milli scnds between ea transition
		//--------------------------------------------------------------------------------//
		
		// Load data.
		//--------------------------------------------------------------------------------//
		d3.csv(pstnsCSV, function(error, dataset) {
			if (error) {  // if file fails to load
				console.log(error);  // log the error
				} else {  // file succssflly loaded!
					console.log(dataset);   // debug
								// dclre glbl vals
			events = dataset;
			noClubs = events.length - iStrt;  // minus date
					}  // sccssfl load enclsng brce
			});  // csv() enclsng paren
			//--------------------------------------------------------------------------------//
			
			// Create SVG element.
			//--------------------------------------------------------------------------------//
			// Margins
			var margin = {top: pddng * 2, right: pddng, bottom: pddng * 2, left: pddng};
			 w = w - margin.left - margin.right;
			 h = h - margin.top - margin.bottom;
			
			//void createSVG() {
			var svg = d3.select("body")
			.append("svg")
			.attr("width", w + margin.left + margin.right)
			.attr("height", h + margin.top + margin.bottom)
			.append("g")
			.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
			
			// Scales
			var xScale = d3.scale.ordinal()
			.domain(d3.range(noClubs))
			.rangeRoundBands([0, w], iconPddng);
			var yScale = d3.scale.linear()
			.domain([0, noClubs])
			.range([h, 0]);
			//var sldrScale = d3.time.scale()
			//.domain([0, d3.max(dataset, function(d) {return d[0];})])	// frst clmn
			//.range([h, 0]);
					 
			 // Icons
			var circles = svg.selectAll("circle")
			//var icons = svg.selectAll("image")
			    .data(events)  // bind ea data elmnt to ea elmnt
			    .enter()  // rtrn placehldr ref to ea new elmnt
			    .append("circle");  // add ea new elmnt to the DOM
				
			circles.attr({	// delete?
				"cx": function(i) {return i * (w / noClubs) / 2;},  // hrzntl pstn
				//"x": function(d, i) {return xScale(i);},  // hrzntl pstn
				"cy": function(d) {return yScale(d);},  // vrtcl pstn
				"r": ((w / noClubs) - iconPddng) / 2
				});

			// Labels
			svg.selectAll("text")  // rtrn empty rfrnce for ea elmnt
			   .data(events)  // bind ea data elmnt to ea elmnt
			   .enter()  // rtrn placehldr ref to ea new elmnt
			   .append("text")  // add ea new elmnt to the DOM
			   .text(function(d) {return d;})
			   /*.attr("text-anchor", "middle")
			   .attr("x", function(d, i) {
			   		return i * (w / dataset.length) + (w / dataset.length - barPadding) / 2;
			   })
			   .attr("y", function(d) {
			   		return h - (d * 4) + 14;
			   })
			   .attr("font-family", "sans-serif")
			   .attr("font-size", "11px")
			   .attr("fill", "white");
			   */
			   .attr({
				"text-anchor": "left",	// or "middle"?
				"x": function(i) {return i * (w / noClubs) / 2;},  // hrzntl pstn
				"y": function(d) {return yScale(d) - iconPddng;},  // above icon
				"font-family": "sans-serif",
				"font-size": "11px",
				"fill": "white"
				});
		   //--------------------------------------------------------------------------------//
	   
		   // Event listener
		   //--------------------------------------------------------------------------------//
		   // On click, update with new data			
			d3.select("p").on("click", function() {
			// New values for dataset
			dataset = [ 11, 12, 15, 20, 18, 17, 16, 18, 23, 25,
			5, 10, 13, 19, 21, 25, 22, 18, 15, 13 ];
			
			// Update icons
			svg.selectAll("circle")
				.data(dataset)
				.transition()
				.duration(intrpltn)
				.ease("circle")
				.attr({
				"y": function(d) {return h - yScale(d);},
				"height": function(d) {return yScale(d);}
				});

			// Update labels
			svg.selectAll("text")
			   .data(dataset)
			   .transition()
			   .duration(intrpltn)
			   .ease("circle")
			   .text(function(d) {return d;})
			   .attr({
			   "x": function(i) {return i * (w / noClubs) / 2;},  // hrzntl pstn
			   "y": function(d) {return yScale(d) - iconPddng;},  // above icon
			   });
			   });
		   //--------------------------------------------------------------------------------//
		   
		//--------------------------------------------------------------------------------//
		//--------------------------------- d3 block end ---------------------------------//
		//--------------------------------------------------------------------------------//			
		</script>

	</body>
</html>