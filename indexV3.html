<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>PremJourney</title>
		<script type="text/javascript" src="/libraries/d3/d3.min.js"></script>
		<style type="text/css">
			/* Enter style rules for axes.*/
      .axis path,
      .axis line {
        fill: none;
        stroke: black;
        shape-rendering: crispEdges;
      }
      .axis text {
        font-family: georgia;
        font_size: 11px;
      }
		</style>
	</head>

	<body>	
	<p>Click on this text to start the season! (once).</p>
	
		<script type="text/javascript">
  //--------------------------------------------------------------------------------//
  //-------------------------------- d3 block start --------------------------------//
  //--------------------------------------------------------------------------------//
  
  // Global Vrbles
  //--------------------------------------------------------------------------------//
  var Viz = {}; // dclre empty glbl objct
  Viz.pstnsCSV = "/visualizations/premRelative201516/prem1516pstns20160126.csv"; // 24th Jan
  Viz.format = d3.time.format("%Y-%m-%d %H:%M:%S"); // evnt prsr
  var clubs = [{}]; // move into mthd scope once wrkng
  var dataset; // move into mthd scope once wrkng
  //--------------------------------------------------------------------------------//
  
  // Load data.
  //--------------------------------------------------------------------------------//
  d3.csv(Viz.pstnsCSV,
   function(d) {return {
    goalTime: Viz.format.parse(d.goalTime),
    Arsenal: +d.Arsenal, AstonVilla: +d.AstonVilla, Bournemouth: +d.Bournemouth,
    Chelsea: +d.Chelsea, CrystalPalace: +d.CrystalPalace, Everton: +d.Everton,
    LeicesterCity: +d.LeicesterCity, Liverpool: +d.Liverpool,
    ManchesterCity: +d.ManchesterCity, ManchesterUnited: +d.ManchesterUnited,
    NewcastleUnited: +d.NewcastleUnited, NorwichCity: +d.NorwichCity,
    Southampton: +d.Southampton, StokeCity: +d.StokeCity, Sunderland: +d.Sunderland,
    SwanseaCity: +d.SwanseaCity, TottenhamHotspur: +d.TottenhamHotspur,
    Watford: +d.Watford, WestBromwichAlbion: +d.WestBromwichAlbion,
    WestHamUnited: +d.WestHamUnited
   };}, // loop thrgh ea row to ensre 100% loaded
   function(error, rows) {
    if (error) {
     console.log(error);  // debug
    } else {
     console.log(rows); // debug
     buildViz(rows);
     }
   }
   );  // csv() enclsng paren
  //--------------------------------------------------------------------------------//
   
  // Build viz
  //--------------------------------------------------------------------------------//
  function buildViz(dataset) {
  events = dataset; // delete
  // Fnctn Scope Vrbles
  //--------------------------------------------------------------------------------//
  var w = 920;  // svg width
  var h = 620;  // svg hght
  var evntTimes = createTimes();
  var clubs = createClubs(); // gnrte objct arry for ea club with meta valsvar iconW = 60;
  var pddng = 50;  // svg pddng
  var intrpltn = 1000;  // milli scnds between ea transition
  //console.log(clubs); // debug
   
  // Margins
  var margin = {top: pddng, right: pddng, bottom: pddng, left: pddng};
   w = w - margin.left - margin.right;
   h = h - margin.top - margin.bottom;

  var iconRdctn = 0.7;
  var iconBndPddng = 0.1;  // % of ea icon band as space between ea other
  var iconHrzntlPddng = -1;
  var iconW = w / clubs.length; // all icons have equal wdth
  var iconH = h / clubs.length; // all icons have equal wdth
  var iconMaxH = d3.max(clubs, function(d) {return d.h;});
  var axsLpddng = 5;
  var axsRpddng = axsLpddng;

  // Create SVG element.
  var svg = d3.select("body") // CSS elmnt
     .append("svg")
     .attr("width", w + margin.left + margin.right)
     .attr("height", h + margin.top + margin.bottom)
     .append("g")
     .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
       
  // Scales
  var xScale = d3.scale.ordinal()
      .domain(d3.range(clubs.length))
      .rangeRoundBands([0, w], iconBndPddng);
      
  var yScale = d3.scale.linear()
        .domain([1, clubs.length])
        .range([1, h]);

  var sldrScale = d3.time.scale()
        .domain([0, d3.max(evntTimes, function(d) {return d;})])
        .range([0, w]);
  
  // Define fnctn to sort objcts into  prev season's standngs.
   var prevSsn = function(a, b) {return d3.ascending(a.pstn[0], b.pstn[0]);} // prev season

  // Create arry of SVGImageElement.
  // Bind club data to the DOM.
  svg.selectAll("image") // SVG elmnt
      .data(clubs)  // bind ea data elmnt to ea elmnt
         .enter()  // rtrn placehldr ref to ea new elmnt
         .append("image")  // add ea new elmnt to the DOM                  
         .sort(prevSsn) // prev season
         .attr({
       "x": function(d, i) {return xScale(i);},  // hrzntl pstn
       // Initially assgn prev seasons final standing.
       "y": function(d) {return yScale(d.pstn[724] - 0.5);},  // vrtcl pstn
       //"height": function(d) {return (d.h / 100) * ;},
       "height": iconH,
       "width": iconW,
       "xlink:href": function(d) {return "/visualizations/premRelative201516/icons/" + d.key + ".png";}
       //"r": ((w / clubs.length) - iconBndPddng) / 2
      });
      //console.log(icons[0]); // debug - delte

  // Define initial labels.
  /*svg.selectAll("text")
        .data(clubs)
        .enter()
        .append("text")
        .sort(prevSsn) // prev season
        .text(function(d) {return d.nme;})
        .attr({
        "x": function(d, i) {return xScale(i) + (iconW + 2);},  // hrzntl pstn 
        // Initially assgn prev seasons final standing.
        "y": function(d) {return yScale(d.pstn[0]);},  // vrtcl pstn
        "font-family": "sans-serif",
        "font-size": "11px",
        "fill": "black",
        "text-anchor": "right"
      });*/

  // Define event listener.
  var cntr = 1;  // strt at scnd row
  d3.select("p")
    .on("click", function() { // do smethng on clck
      // Upte icon pstns.
      svg.selectAll("image")
          .data(clubs)
          //.sort(prevSsn) // prev season
          .attr("y", function(d) {return yScale(d.pstn[cntr] - 0.5);})  // vrtcl pstn
          cntr++;
     });

  // Define axes.
  var tckPstn = function(d) {
    if (d > 3) {
      return d + "th";
    } else if (d == 1) {
      return d + "st";
    } else if (d == 2) {
      return d + "nd";
    } else {
      return d + "rd";
    }
  }

  var lAxis = d3.svg.axis()
                .scale(yScale)
                .orient("left")
                .ticks(clubs.length)  // set rough no of tcks
                .tickFormat(tckPstn);
  svg.append("g")
      .attr({
        "class": "axis"  // assgn css class "axis"
      })
      .call(lAxis);

  var rAxis = d3.svg.axis()
                .scale(yScale)
                .orient("right")
                .ticks(clubs.length)  // set rough no of tcks
                .tickFormat(tckPstn);
  svg.append("g")
      .attr({
        "class": "axis",  // assgn css class "axis"
        "transform": "translate(" + w + ")" // assgn to right hand side
      })
      .call(rAxis);
   
  }  // buidViz enclsng brce
  //--------------------------------------------------------------------------------//
  
  // Mthd to create arry of ea evnt time elmnt.
  //--------------------------------------------------------------------------------//
  function createTimes() {
      var evntTimes = [{}];
      for (i = 0; i < events.length; i++) {
          evntTimes.push(events[i].goalTime);
          } // ea evnt enclsng brce

          return evntTimes;
         }  // mthd enclsng brce
    //--------------------------------------------------------------------------------//

  // Mthd to parse all data fields from a flat file.
  //--------------------------------------------------------------------------------//
  function createClubs() {
    var keys = ["Arsenal", "AstonVilla", "Bournemouth", "Chelsea", "CrystalPalace",
    "Everton", "LeicesterCity", "Liverpool", "ManchesterCity", "ManchesterUnited",
    "NewcastleUnited", "NorwichCity", "Southampton", "StokeCity", "Sunderland",
    "SwanseaCity", "TottenhamHotspur", "Watford", "WestBromwichAlbion", "WestHamUnited"];
    var nmes = ["Arsenal", "Villa", "Bournemouth", "Chelsea", "Palace", "Everton",
    "Leicester", "Liverpool", "Man City", "Man U", "Newcastle", "Norwich",
    "Southampton", "Stoke", "Sunderland", "Swansea", "Spurs", "Watford", "West Brom",
    "West Ham"];

  // Create arry pstns for ea club.
  var arse = [], villa = [], brnmth = [], chlsea = [], plce = [], evrtn = [], lcstr = [],
  lvrpl = [], mnCty = [], manU = [], nwcstle = [], nrwch = [], sthmptn = [], stke = [],
  sndrlnd = [], swnswa = [], sprs = [], wtfrd = [], wstBrm = [], wstHm = [];
  for (i = 0; i < events.length; i++) {
          arse.push(events[i].Arsenal); villa.push(events[i].AstonVilla);
          brnmth.push(events[i].Bournemouth); chlsea.push(events[i].Chelsea);
          plce.push(events[i].CrystalPalace); evrtn.push(events[i].Everton);
          lcstr.push(events[i].LeicesterCity); lvrpl.push(events[i].Liverpool);
          mnCty.push(events[i].ManchesterCity); manU.push(events[i].ManchesterUnited);
          nwcstle.push(events[i].NewcastleUnited); nrwch.push(events[i].NorwichCity);
          sthmptn.push(events[i].Southampton); stke.push(events[i].StokeCity);
          sndrlnd.push(events[i].Sunderland); swnswa.push(events[i].SwanseaCity);
          sprs.push(events[i].TottenhamHotspur); wtfrd.push(events[i].Watford);
          wstBrm.push(events[i].WestBromwichAlbion); wstHm.push(events[i].WestHamUnited);
          } // ea evnt enclsng brce
  var clbPstns = [arse, villa, brnmth, chlsea, plce, evrtn, lcstr, lvrpl, mnCty, manU,
  nwcstle, nrwch, sthmptn, stke, sndrlnd, swnswa, sprs, wtfrd, wstBrm, wstHm];
  // Icon hghts in alphabetical order.  
  var icnHghts = [71, 84, 79, 60, 75, 61, 60, 81, 71, 61, 60, 67, 68, 69, 50, 57, 118, 67,
  72, 58];
          
  // Create club objcts.
  var clubs = [{}];
  clubs[0] = {key: keys[0], nme: nmes[0], h: icnHghts[0], pstn: clbPstns[0]};
  for (i = 1; i < keys.length; i++) {
    clubs.push({key: keys[i], nme: nmes[i],  h: icnHghts[i], pstn: clbPstns[i]});
    } // ea club enclsng brce

    return clubs;
    }  // mthd enclsng brce
  //--------------------------------------------------------------------------------//

  // Mthd to move icons to the next event.
  //--------------------------------------------------------------------------------//
  /*function nxtEvnt() {
    svg.selectAll("image")
        .data(clubs)  // rebind new vals
         .sort(prevSsn) // prev season
         .attr({
       //"x": function(d, i) {return xScale(i);},  // hrzntl pstn
       // Initially assgn prev seasons final standing.
       "y": function(d) {return yScale(d.pstn[1] - 0.5);},  // vrtcl pstn
       //"height": function(d) {return (d.h / 100) * ;},
       //"height": iconH,
       //"width": iconW,
       //"xlink:href": function(d) {return "/icons/" + d.key + ".png";}
       //"r": ((w / clubs.length) - iconBndPddng) / 2
      });
  }*/  // mthd enclsng brce
  //--------------------------------------------------------------------------------//


  //--------------------------------------------------------------------------------//
  //--------------------------------- fnctns start ---------------------------------//
  //--------------------------------------------------------------------------------//   
  
  //--------------------------------------------------------------------------------//
  //---------------------------------- fnctns end ----------------------------------//
  //--------------------------------------------------------------------------------//   
  
  //--------------------------------------------------------------------------------//
  //--------------------------------- d3 block end ---------------------------------//
  //--------------------------------------------------------------------------------//   
  </script>

	</body>
</html>
